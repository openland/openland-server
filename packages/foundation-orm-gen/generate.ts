import { SchemaModel } from './Model';
import * as fs from 'fs';
import { generateEntity } from './generators/Entity';
import { generateAllEntities } from './generators/AllEntities';

export function generate(model: SchemaModel, path: string) {
    let res = '// THIS FILE IS AUTOGENERATED! DO NOT TRY TO EDIT!\n';
    res += '// @ts-ignore\n';
    res += 'import { EntitiesBase } from \'foundation-orm/EntitiesBase\';\n';
    res += '// @ts-ignore\n';
    res += 'import { Subspace, Directory, Tuple } from \'@openland/foundationdb\';\n';
    res += '// @ts-ignore\n';
    res += 'import { FEntity, FEntityOptions } from \'foundation-orm/FEntity\';\n';
    res += '// @ts-ignore\n';
    res += 'import { FEntitySchema } from \'foundation-orm/FEntitySchema\';\n';
    res += '// @ts-ignore\n';
    res += 'import { FEntityIndex } from \'foundation-orm/FEntityIndex\';\n';
    res += '// @ts-ignore\n';
    res += 'import { FEntityFactory } from \'foundation-orm/FEntityFactory\';\n';
    res += '// @ts-ignore\n';
    res += 'import { FConnection } from \'foundation-orm/FConnection\';\n';
    res += '// @ts-ignore\n';
    res += 'import { validators } from \'foundation-orm/utils/validators\';\n';
    res += '// @ts-ignore\n';
    res += 'import { EntityLayer } from \'foundation-orm/EntityLayer\';\n';
    res += '// @ts-ignore\n';
    res += 'import { Context } from \'@openland/context\';\n';
    res += '// @ts-ignore\n';
    res += 'import { json, jField, jNumber, jString, jBool, jVec, jEnum, jEnumString } from \'openland-utils/jsonSchema\';\n';
    res += '\n';
    for (let e of model.entities) {
        res += generateEntity(e);
        res += '\n';
    }
    res += '\n';
    res += generateAllEntities(model.entities, model.directories);
    fs.writeFileSync(path, res);
}