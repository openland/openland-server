#
# Subscription
#

type UpdateSubscriptionStarted {
    seq: Int!
    state: String!
}

type UpdateSubscriptionCheckpoint {
    seq: Int!
    state: String!
}

type UpdateSubscriptionEvent {
    seq: Int!
    pts: Int!
    event: UpdateEvent!
    sequence: Sequence!
}

union UpdateSubscription = UpdateSubscriptionStarted | UpdateSubscriptionCheckpoint | UpdateSubscriptionEvent

extend type Subscription {
    watchUpdates: UpdateSubscription!
}

#
# State
#

type UpdatesSequenceState {
    sequence: Sequence!
    pts: Int!
}

type UpdatesState {
    seq: Int!
    state: String!
    sequences: [UpdatesSequenceState!]!
}

extend type Query {
    updatesState: UpdatesState!
    sequenceState(id: ID!): UpdatesSequenceState!
}

#
# Difference 
#

type UpdatesDifferenceEvent {
    pts: Int!
    event: UpdateEvent!
}

type UpdatesSequenceDifference {
    after: Int!
    sequence: Sequence!
    events: [UpdatesDifferenceEvent!]!
}

type UpdatesDifference {
    seq: Int!
    state: String!
    hasMore: Boolean!
    sequences: [UpdatesSequenceDifference!]!
}

type SequenceDifference {
    sequence: Sequence!
    events: [UpdatesDifferenceEvent!]!
    hasMore: Boolean!
}

extend type Query {
    updatesDifference(state: String!): UpdatesDifference!
    sequenceDifference(id: ID!, pts: Int!): s!
}