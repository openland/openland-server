interface ModernMessage {
    #
    #   State
    #
    id: ID!
    date: Date!
    sender: User!

    #
    #   Content
    #
    message: String
    spans: [MessageSpan!]!
    fallback: String!
}

type ServiceMessage implements ModernMessage  {
    #
    #   State
    #
    id: ID!
    date: Date!
    sender: User!

    #
    #   Content
    #
    message: String
    spans: [MessageSpan!]!
    serviceMetadata: ServiceMetadata
    fallback: String!
}

type GeneralMessage implements ModernMessage {
    #
    #   State
    #
    id: ID!
    date: Date!
    sender: User!
    edited: Boolean!
    reactions: [ModernMessageReaction!]!

    #
    #   Content
    #
    message: String
    spans: [MessageSpan!]!
    attachments: [ModernMessageAttachment!]!
    quotedMessages: [ModernMessage!]!
    fallback: String!
}

extend type Query {
    messages(chatId: ID!, first: Int!, before: ID): [ModernMessage!]!
}

#extend type Mutation {
#    modernSendMessage(room: ID!, message: String, repeatKey: String, forwardMessages: [ID!], spans: [MessageSpanInput!], attachments: [MessageAttachmentInput!]): Boolean!
#}

input MentionInput {
    chatId: ID
    userId: ID
    offset: Int!
    length: Int!
}

extend type Mutation {
    sendMessage(chatId: ID!, message: String, repeatKey: String, mentions: [MentionInput!]): Boolean!
}
#
#   Attachments
#

type Image {
    url: String!
    metadata: FileMetadata
}

interface ModernMessageAttachment {
    id: ID!
    fallback: String!
}

type MessageRichAttachment implements ModernMessageAttachment {
    id: ID!
    title: String
    subTitle: String
    titleLink: String
    text: String
    icon: Image
    image: Image
    keyboard: MessageKeyboard
    fallback: String!
}

type MessageAttachmentFile implements ModernMessageAttachment {
    id: ID!
    fileId: String!
    fileMetadata: FileMetadata!
    filePreview: String
    fallback: String!
}

type MessageAttachmentPost implements ModernMessageAttachment {
    id: ID!
    post: FeedItem!
    fallback: String!
}

# union MessageAttachmentInput = MessageRichAttachmentInput | MessageAttachmentFileInput | MessageAttachmentPostInput

input MessageRichAttachmentInput {
    title: String
    titleLink: String
    text: String
    icon: String
    image: String
    keyboard: MessageKeyboardInput
    fallback: String
}

type MessageAttachmentFileInput {
    fileId: String!
    fallback: String
}

type MessageAttachmentPostInput {
    postId: ID!
    fallback: String
}

#
#   Keyboard
#
type MessageKeyboard {
    buttons: [[ModernMessageButton!]]!
}

type ModernMessageButton {
    id: ID!
    title: String!
    style: ModernMessageButtonStyle!
}

enum ModernMessageButtonStyle {
    DEFAULT,
    LIGHT
}

input MessageKeyboardInput {
    buttons: [[ModernMessageButtonInput!]]!
}

input ModernMessageButtonInput {
    id: ID!
    title: String!
    style: ModernMessageButtonStyle!
}

#
#   Reactions
#

enum MessageReactionType {
    LIKE,
    THUMB_UP,
    JOY,
    SCREAM,
    CRYING,
    ANGRY
}

type ModernMessageReaction {
    user: User!,
    reaction: MessageReactionType!
}

#
#   Rich text
#

interface MessageSpan {
    offset: Int!
    length: Int!
}

type MessageSpanUserMention implements MessageSpan {
    offset: Int!
    length: Int!
    user: User!
}

type MessageSpanMultiUserMention implements MessageSpan {
    offset: Int!
    length: Int!
    users: [User!]!
}

type MessageSpanRoomMention implements MessageSpan {
    offset: Int!
    length: Int!
    room: Room!
}

type MessageSpanLink implements MessageSpan {
    offset: Int!
    length: Int!
    url: String!
}

# union MessageSpanInput = MessageSpanUserMentionInput | MessageSpanRoomMentionInput

input MessageSpanUserMentionInput {
    offset: Int!
    length: Int!
    userId: ID!
}

input MessageSpanRoomMentionInput {
    offset: Int!
    length: Int!
    roomId: ID!
}