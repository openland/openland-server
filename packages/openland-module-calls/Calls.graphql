type ICEServer {
    urls: [String!]!
    username: String
    credential: String
}

enum ConferenceStrategy {
    MASH,
    SFU
}

enum ConferenceKind {
    CONFERENCE,
    STREAM
}

type Conference {
    id: ID!
    startTime: Date
    peers: [ConferencePeer!]!
    iceServers: [ICEServer!]!
    strategy: ConferenceStrategy!
    kind: ConferenceKind!
}

type ConferencePeer {
    id: ID!
    user: User!
}

type ConferenceMedia {
    id: ID!
    streams: [MediaStream!]!
    iceServers: [ICEServer!]!
}

enum MediaStreamState {
    WAIT_OFFER
    NEED_OFFER
    WAIT_ANSWER
    NEED_ANSWER
    READY
}

enum MediaStreamIceTransportPolicy {
    all
    relay
}

type MediaStreamSettings {
    videoIn: Boolean!
    videoOut: Boolean!
    videoOutSource: MediaStreamVideoSource
    audioIn: Boolean!
    audioOut: Boolean!
    iceTransportPolicy: MediaStreamIceTransportPolicy
}

enum MediaStreamVideoSource {
    camera,
    screen_share
}

type MediaStreamMediaState {
    videoPaused: Boolean
    audioPaused: Boolean
    videoSource: MediaStreamVideoSource

    # deprecated
    videoOut: Boolean!
    audioOut: Boolean!
}
input MediaStreamMediaStateInput {
    videoPaused: Boolean
    audioPaused: Boolean

    # deprecated
    videoOut: Boolean
    audioOut: Boolean
    
}

type LocalStreamAudioConfig {
    codec: String!
}
type LocalStreamVideoConfig {
    codec: String!
}
type LocalStreamDataChannelConfig {
    id: Int!
    label: String!
    ordered: Boolean!
}

union LocalStreamConfig = LocalStreamAudioConfig | LocalStreamVideoConfig | LocalStreamDataChannelConfig

type MediaStream {
    id: ID!
    peerId: ID
    state: MediaStreamState!
    seq: Int!
    sdp: String
    ice: [String!]!
    settings: MediaStreamSettings!
    mediaState: MediaStreamMediaState!
    localStreams: [LocalStreamConfig!]!
}

input ConferenceSettingsInput {
    strategy: ConferenceStrategy
    iceTransportPolicy: MediaStreamIceTransportPolicy
}

type ConferenceJoinResult {
    peerId: ID!
    conference: Conference!
}

extend type Query {
    conference(id: ID!): Conference!
    conferenceMedia(id: ID!, peerId: ID!): ConferenceMedia!
}

extend type Mutation {
    conferenceJoin(id: ID!, kind: ConferenceKind): ConferenceJoinResult!
    conferenceAddScreenShare(id: ID!): Conference!
    conferenceRemoveScreenShare(id: ID!): Conference!
    conferenceAlterMediaState(id: ID!, state: MediaStreamMediaStateInput!): Conference!
    conferenceKeepAlive(id: ID!, peerId: ID!): Conference!
    conferenceLeave(id: ID!, peerId: ID!): Conference!
    conferenceAlterSettings(id: ID!, settings: ConferenceSettingsInput!): Conference!

    mediaStreamOffer(id: ID!, peerId: ID!, offer: String!, seq: Int): ConferenceMedia!
    mediaStreamNegotiationNeeded(id: ID!, peerId: ID!, seq: Int): ConferenceMedia!
    mediaStreamAnswer(id: ID!, peerId: ID!, answer: String!, seq: Int): ConferenceMedia!
    mediaStreamCandidate(id: ID!, peerId: ID!, candidate: String!): ConferenceMedia!
    mediaStreamFailed(id: ID!, peerId: ID!): ConferenceMedia!
}

extend type Subscription {
    alphaConferenceWatch(id: ID!): Conference!
    alphaConferenceMediaWatch(id: ID!, peerId: ID!): ConferenceMedia!
}